function [files, sequence, root, details] =dbs_subjects_percept(initials, rec_id)

if nargin <2
    rec_id = 1;
end

dbsroot = '\\piazzolla\vlad_shared';
outroot = 'D:\home\Data\DBS-MEG';

details = struct(...
    'mridir', fullfile(dbsroot, initials, 'MRI'));

details.chan = {'LFP'};
details.badchanthresh = 0.1;
details.bandstop = [70 180];

details.suffix = {'rec_1', 'rec_2', 'rec_3'};

details.eeg_ref = 'StimArt';
details.removesync = true;
details.synch_ecg=0;
details.process_logfiles=1;
details.process_videos=1;

% details.chanset = getfield(load(details.chanset), 'label');
%
% name = fieldnames(montage);
% montage = getfield(montage, name{1});
%
% details.fiducials = fullfile(dbsroot, initials, 'MRI', [initials '_smri_fid.txt']);


switch initials
    case 'LN_PR_D001'
        if rec_id == 1
            files={...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0001.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0002.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0003.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0005.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0006.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0007.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0008.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0019.vhdr'
                };
            sequence = {'R', 'PMT', 'ACT', 'SST', 'HPT', 'POUR', 'POUR', 'WALK'};
            root='\LN_PR_D001\rec1\';
            details.lfpthresh = 20;
        elseif rec_id == 2
            files={...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0012.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0013.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0014.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0015.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0016.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0017.vhdr',...
                '\LN_PR_D001\raw_EEG\LN_PR_D001_0=20220107_0018.vhdr'
                };
            sequence = {'R', 'PMT', 'ACT', 'SST', 'HPT', 'POUR', 'WALK'};
            root='\LN_PR_D001\rec2\';
            details.lfpthresh = 50;
            details.badchanthresh = 0.2;
        end
        details.bandstop = [70];
        details.lfp_ref = 'LFP_Gpi_R_02';
        details.chan = {'LFP_Gpi_R_02'};
    case 'LN_PR_D003'
        if rec_id == 1
            files={...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0001.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0002.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0003.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0004.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0005.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0006.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0007.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0008.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0021.vhdr',...
                };
            sequence = {'R', 'PMT', 'ACT', 'SST', 'HPT', 'SGT', 'SPEAK', 'POUR', 'WALK'};
            root='\LN_PR_D003\rec1\';
        elseif rec_id == 2
            files={...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0010.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0011.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0012.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0013.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0014.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0016.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0017.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0018.vhdr',...
                '\LN_PR_D003\raw_EEG\LN_PR_D003_20220204_0020.vhdr',...
                };
            sequence = {'R', 'PMT', 'ACT', 'SST', 'HPT', 'SGT', 'SPEAK', 'POUR', 'WALK'};
            root='\LN_PR_D001\rec2\';
        end
        details.lfpthresh = 20;
        details.bandstop = [70];
        details.eeg_ref='P3'; 
        % note that it's only necessary to change ref to P3 for some of the files 
        % but check if it works for all of them and just leave it like this

    case 'LN_PR_D004'
        if rec_id == 2
            files={...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0001.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0002.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0003.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0004.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0005.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0006.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0007.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0008.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0019.vhdr',...
                };
            sequence =  {'R', 'PMT', 'ACT', 'SST', 'HPT', 'SPEAK', 'POUR', 'WALK'};
            root='\LN_PR_D004\rec2\';
        elseif rec_id == 1
            files={...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0009.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0010.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0011.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0012.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0013.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0014.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0015.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0016.vhdr',...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0018.vhdr',...
                };
            sequence = {'R', 'PMT', 'ACT', 'SST', 'HPT', 'SPEAK', 'POUR', 'R', 'WALK'};
            root='\LN_PR_D004\rec1\';
        elseif rec_id == 3
            files={...
                '\LN_PR_D004\raw_EEG\LN_PR_D004_20220304_0020.vhdr',...
                };
            sequence = {'R'};
            root='\LN_PR_D004\rec3\';
        end
        details.lfpthresh = 20;
        details.bandstop = [70];
    case 'LN_PR_D005'
        if rec_id == 2
            files={...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0001.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0002.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0003.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0004.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0005.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0006.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0007.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0008.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0018.vhdr'

                };
            sequence =  {'R', 'PMT', 'ACT', 'SST', 'HPT', 'SGT', 'SPEAK', 'POUR', 'WALK'};
            root='\LN_PR_D005\rec2\';
        elseif rec_id == 1
            files={...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0009.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0010.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0011.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0012.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0013.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0014.vhdr',...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0016.vhdr'
                };
            sequence = {'R', 'SGT', 'HPT', 'ACT', 'SST', 'R', 'SGT'};
            root='\LN_PR_D005\rec1\';
        elseif rec_id == 3
            files={...
                '\LN_PR_D005\raw_EEG\LN_PR_D005_20220401_0017.vhdr',...
                };
            sequence = {'R'};
            root='\LN_PR_D005\rec3\';
        end
        details.lfpthresh = 20;
        details.bandstop = [70];
        details.lfp_ref = 'LFP_Gpi_L_02';
end

files = files(:);

[~, file_table] = xlsread(fullfile(dbsroot, initials, [initials '.xlsx']));
file_table_array=readmatrix(fullfile(dbsroot, initials, [initials '.xlsx']));
details.vidoffset=zeros(2,length(files));

for f=1:length(files)
    ind = strmatch(spm_file(files{f}, 'basename'), file_table(:, 1), 'exact');

    lfp_file = {};
    log_file = {};
    for i = 1:numel(ind)
        lfp_file{i}   =  fullfile(dbsroot, initials, 'raw_LFP', file_table{ind, 2});
        log_file{i}   =  spm_file(fullfile(dbsroot, initials, 'raw_Logfiles', file_table{ind, 4}), 'ext', '.mat');
        video_file{i} =  fullfile(dbsroot, initials, 'processed_MotionCapture', 'jsons', file_table{2, 3});
        LED_file{i}   =  fullfile(dbsroot, initials, 'processed_MotionCapture', 'LED_videos', file_table{2, 3});
    end

    if numel(ind)==1
        files(f, 2) = lfp_file;
        files(f, 3) = log_file;
        files(f, 4) = video_file;
        files(f, 5) = LED_file;
    else
        files{f, 2} = lfp_file;
        files{f, 3} = log_file;
        files{f, 4} = video_file;
        files{f, 5} = LED_file;
    end

    files{f, 1} = fullfile(dbsroot, files{f});
    

    if file_table_array(ind-1, 5)==1
        details.vidoffset_tocompute{f}='yes';
    else
        details.vidoffset_tocompute{f}='no';
        details.vidoffset(:,f)=[file_table_array(ind-1, 6) file_table_array(ind-1, 7)];
    end
end



root = fullfile(outroot, root);